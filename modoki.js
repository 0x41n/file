const de=e=>{let l=0,r,t,i;for(e=e.slice(1),t=(r=[...new Set(e.split(""))].sort()).length+1,i=parseInt(t/2),r.splice(i,0,"");l<t;l++)e=e.replaceAll(r[(l+i+1)%t],r[(l+i)%t]);return e},modoki=l=>{l=(l="Â¨"==l[0]?de(l):l).replace(/\n/g,"")+"";let e="",r,t,i,s=[0,""],$=(e,l,r=0)=>e.indexOf(l,r),o=(e,l)=>e.startsWith(l),a=e=>e.length,n=(e,l)=>""==l?b(e):`<${l}>${b(e)}</${l}>`,f=(e,l,r)=>[p(e,l)[0],n(p(e,l)[1],r),p[1]],p=(e,l,r=l)=>{var t=$(e,l)+a(l),i=$(e,r,t+1);return[i+a(r),e.slice(t,i)]},c=["1. ","- ","|","> ","$$","#"],h=(l,r,t=[])=>{let i="",s,c;for(let e=0;e<a(l);e++)s=$(l[e]," ")+1,c=o(l[e],"^")?` rowspan="${s}"`:o(l[e],">")?` colspan="${s}"`:"",l[e]=c?l[e].slice(s):l[e],i+=`<${r+c} style="text-align:${void 0===t[e]||2!=a(t[e].split(":"))?"center":o(t[e],":")?"left":"right"}">${l[e]}</${r}>`;return n(i,"tr")},u=(e,l,r)=>e.replaceAll(l,r),d=e=>0<$(e,"</")?d(u(e.slice(0,$(e,"</")).split("").reverse().join(""),">","</")):e,b=l=>{let e="",r=[],t,i,s,c=["*","`","~~","__","{","[","++"];for(;0<a(l);)o(l,"*")?(r="*"==l[1]?f(l,"**","b"):f(l,"*","em"),e+=r[1]):o(l,"`")?(r=f(l,"`","code"),e+=r[1]):o(l,"~~")?(r="~"==l[2]?f(l,"~~~","pre"):f(l,"~~","strike"),e+=r[1]):o(l,"__")?(r=f(l,"__","u"),e+=r[1]):o(l,"{")?(r=p(l,"{","}"),s=r[1].split("|"),r[2]=s[1],e+=n(s[0]+n(s[1],"rt"),"ruby")):o(l,"[")?"["==l[1]?(r=p(l,"[[","]]"),e+=`<iframe src="${r[1]}"></iframe>`):(t=p(l,"[","]"),l=l.slice(t[0]),r=p(l,"(",")"),s=0<$(r[1],'"')?'"title="'+p(r[1],'"')[1]:"",r[1]=u(r[1],"#",""),s&&(r[1]=r[1].slice(0,$(r[1],'"'))),e+=`<a href="${r[1]+s+(o(r[1],"")?"":'"target="_blank"rel="noopener noreferrer')}">${b(t[1])}</a>`):o(l,"++")?(r=p(l,"++","++"),i=r[1].split("+"),e+=n(n(i[0],"summary")+i[1],"details")):(i=a(l),c.forEach(e=>i=i>$(l,e)&&-1<$(l,e)?$(l,e):i),r[0]=i,e+=l.slice(0,i)),l=l.slice(r[0]);return e};for(l=b(l);1<a(l);){if(o(l,"#"))t=6<(t=$(l," "))?6:t,s=p(l," ",""),e+=`<h${t} id="${d(s[1])}">${s[1]}</h${t}>`;else if(o(l,"- - -"))s[0]=5,e+="<hr>";else if(o(l,"- ")||o(l,"1. ")){for(i=o(l,"- ")?["- ","ul"]:["1. ","ol"],e+=`<${i[1]}>`;o(l,i[0]);)t=p(l," ",""),e+=n(t[1],"li"),l=l.slice(t[0]);e+=`</${i[1]}>`,s[0]=0}else if(o(l,"|")){for(t=p(l,"|","|"),e+="<table>"+h(t[1].split("|"),"th"),l=l.slice(t[0]-1),r=p(l,"|","|"),l=l.slice(r[0]-1);o(l,"|");)t=p(l,"|","|"),e+=h(t[1].split("|"),"td",r[1].split("|")),l=l.slice(t[0]-1);e+="</table>",s[0]=1}else if(o(l,"> ")){for(i="",l=l.slice(1);o(l,"> ");)t=$(l,"")+1,i+=l.slice(2,t),l=l.slice(t);e+=n(i,"blockquote"),s[0]=0}else o(l,"$$")?(s=p(l,"$$"),t=s[1].split("$"),e=n(t[0],"h2")+t[1]+""+e):(t=a(l),c.forEach(e=>t=t>$(l,e)&&-1<$(l,e)?$(l,e):t),s[0]=t,e+=l.slice(0,t));l=l.slice(s[0])}return u(u(e,"","#"),"","<br>")};
