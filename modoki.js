const de=e=>{let l=0,i,s,t;for(e=e.slice(1),s=(i=[...new Set(e.split(""))].sort()).length+1,t=parseInt(s/2),i.splice(t,0,"");l<s;l++)e=e.replaceAll(i[(l+t+1)%s],i[(l+t)%s]);return e},modoki=l=>{l="â€‹"==l[0]?de(l):l,l+="\n";let e="",c,n,f,i=[0,[]],o=(e,l,i=0)=>e.indexOf(l,i),a=(e,l)=>e.startsWith(l),$=(e,l)=>""==l?g(e):`<${l}>${g(e)}</${l}>`,p=(e,l,i="")=>{var s=l.length,l=o(e,l,s+1);return[l+s,$(e.slice(s,l),i)]},g=i=>{let e="",s=[0,0],r=["*","`","~~","__","{","[","#"],l;for(;0<i.length;){if(a(i,"#"))l=o(i," "),s[0]=o(i,"\n")+1,l=6<l?6:l,n=i.slice(l+1,s[0]-1),e+=`<h${l} id="${n}">${n}</h${l}>`;else if(a(i,"*"))s="*"==i[1]?p(i,"**","b"):p(i,"*","em"),e+=s[1];else if(a(i,"`"))s=p(i,"`","code"),e+=s[1];else if(a(i,"~~"))s="~"==i[2]?p(i,"~~~","pre"):p(i,"~~","strike"),e+=s[1];else if(a(i,"__"))s=p(i,"__","u"),e+=s[1];else if(a(i,"{"))s[0]=o(i,"}")+1,f=i.slice(1,s[0]-1).split("|"),e+=$(f[0]+$(f[1],"rt"),"ruby");else if(a(i,"["))"["==i[1]?(s[0]=o(i,"]]")+2,e+=`<iframe src="${i.slice(2,s[0]-2)}"></iframe>`):(l=o(i,"]"),t=i.slice(1,l),c=i.slice(o(i,"(")+1,o(i,")"),l+1),h="",1<(f=o(c,'"')+1)&&(h=c.slice(f,o(c,'"',f)),c=c.slice(0,o(c," "))),e+=`<a href="${c}"title="${h}"${a(c,"#")?"":'target="_blank"rel="noopener noreferrer"'}>${g(t)}</a>`,s[0]=o(i,")")+1);else{let l=i.length;r.forEach(e=>l=l>o(i,e)&&-1<o(i,e)?o(i,e):l),e+=i.slice(0,l),s[0]=l}i=i.slice(s[0])}return e},s=(l,i,s=[])=>{let t="";for(let e=1;e<l.length-1;e++)t+=`<${i} style="text-align:${void 0===s[e]||2<s[e].split(":").length?"center":a(s[e],":")?"left":"right"}">${g(l[e])}</${i}>`;return $(t,"tr")},r=["1. ","- ","| ","++","> "];for(;0<l.length;){if(a(l,"++"))i[0]=o(l,"\n")+1,c=l.slice(2,i[0]-1).split("|"),e+=$($(c[0],"summary")+c[1],"details");else if(a(l,"- - -"))i[0]=5,e+="<hr>";else if(a(l,"- ")||a(l,"1. ")){for(f=a(l,"- ")?["- ","ul"]:["1. ","ol"],e+=`<${f[1]}>`;a(l,f[0]);)e+=$(l.slice(o(l," ")+1,o(l,"\n")),"li"),l=l.slice(o(l,"\n")+1);e+=`</${f[1]}>`,i[0]=0}else if(a(l,"| ")){for(n=o(l,"\n"),f=l.slice(0,n).split("|"),e+="<table>"+s(f,"th"),l=l.slice(n+1),n=o(l,"\n"),c=l.slice(0,n).split("|"),l=l.slice(n+1);a(l,"|");)n=o(l,"\n"),f=l.slice(0,n).split("|"),e+=s(f,"td",c),l=l.slice(n+1);e+="</table>",i[0]=0}else if(a(l,"> ")){for(f="";a(l,"> ");)n=o(l,"\n")+1,f+=l.slice(2,n),l=l.slice(n);e+=$(f,"blockquote"),i[0]=0}else n=l.length,r.forEach(e=>n=n>o(l,e)&&-1<o(l,e)?o(l,e):n),i[0]=n,e+=g(l.slice(0,n));l=l.slice(i[0])}return e.replace(/\n/g,"<br>")};
