const de=e=>{let l=0,r,i,s;for(e=e.slice(1),i=(r=[...new Set(e.split(""))].sort()).length+1,s=parseInt(i/2),r.splice(s,0,"");l<i;l++)e=e.replaceAll(r[(l+s+1)%i],r[(l+s)%i]);return e},modoki=l=>{l=(l="Â¨"==l[0]?de(l):l).replace(/\n/g,"")+"";let e="",r,i,s,t=[0,""],$=(e,l,r=0)=>e.indexOf(l,r),o=(e,l)=>e.startsWith(l),a=e=>e.length,n=(e,l)=>""==l?b(e):`<${l}>${b(e)}</${l}>`,f=(e,l,r)=>[p(e,l)[0],n(p(e,l)[1],r),p[1]],p=(e,l,r=l)=>{var i=$(e,l)+a(l),s=$(e,r,i+1);return[s+a(r),e.slice(i,s)]},c=["1. ","- ","|","> ","$$","#"],h=(l,r,i=[])=>{let s="",t,c;for(let e=0;e<a(l);e++)t=$(l[e]," ")+1,c=o(l[e],"^")?` rowspan="${t}"`:o(l[e],">")?` colspan="${t}"`:"",l[e]=c?l[e].slice(t):l[e],s+=`<${r+c} style="text-align:${void 0===i[e]||2!=a(i[e].split(":"))?"center":o(i[e],":")?"left":"right"}">${l[e]}</${r}>`;return n(s,"tr")},u=(e,l,r)=>e.replaceAll(l,r),d=e=>0<$(e,"</")?d(u(e.slice(0,$(e,"</")).split("").reverse().join(""),">","</")):e,b=l=>{let e="",r=[],i,s,t,c=["*","`","~~","__","{","[","++"];for(;0<a(l);)o(l,"*")?(r="*"==l[1]?f(l,"**","b"):f(l,"*","em"),e+=r[1]):o(l,"`")?(r=f(l,"`","code"),e+=r[1]):o(l,"~~")?(r="~"==l[2]?f(l,"~~~","pre"):f(l,"~~","strike"),e+=r[1]):o(l,"__")?(r=f(l,"__","u"),e+=r[1]):o(l,"{")?(r=p(l,"{","}"),t=r[1].split("|"),r[2]=t[1],e+=n(t[0]+n(t[1],"rt"),"ruby")):o(l,"[")?"["==l[1]?(r=p(l,"[[","]]"),e+=`<iframe src="${r[1]}"></iframe>`):(i=p(l,"[","]"),l=l.slice(i[0]),r=p(l,"(",")"),t=0<$(r[1],'"')?'"title="'+p(r[1],'"')[1]:"",r[1]=u(r[1],"#",""),t&&(r[1]=r[1].slice(0,$(r[1],'"'))),e+=`<a href="${r[1]+t+(o(r[1],"")?"":'"target="_blank"rel="noopener noreferrer')}">${b(i[1])}</a>`):o(l,"++")?(r=p(l,"++","++"),s=$(r[1],"+"),e+=n(n(r[1].slice(0,s),"summary")+r[1].slice(s+1),"details")):(s=a(l),c.forEach(e=>s=s>$(l,e)&&-1<$(l,e)?$(l,e):s),r[0]=s,e+=l.slice(0,s)),l=l.slice(r[0]);return e};for(l=b(l);1<a(l);){if(o(l,"#"))i=6<(i=$(l," "))?6:i,t=p(l," ",""),e+=`<h${i} id="${d(t[1])}">${t[1]}</h${i}>`;else if(o(l,"- - -"))t[0]=5,e+="<hr>";else if(o(l,"- ")||o(l,"1. ")){for(s=o(l,"- ")?["- ","ul"]:["1. ","ol"],e+=`<${s[1]}>`;o(l,s[0]);)i=p(l," ",""),e+=n(i[1],"li"),l=l.slice(i[0]);e+=`</${s[1]}>`,t[0]=0}else if(o(l,"|")){for(i=p(l,"|","|"),e+="<table>"+h(i[1].split("|"),"th"),l=l.slice(i[0]-1),r=p(l,"|","|"),l=l.slice(r[0]-1);o(l,"|");)i=p(l,"|","|"),e+=h(i[1].split("|"),"td",r[1].split("|")),l=l.slice(i[0]-1);e+="</table>",t[0]=1}else if(o(l,"> ")){for(s="",l=l.slice(1);o(l,"> ");)i=$(l,"")+1,s+=l.slice(2,i),l=l.slice(i);e+=n(s,"blockquote"),t[0]=0}else o(l,"$$")?(t=p(l,"$$"),i=t[1].split("$"),e=n(i[0],"h2")+i[1]+""+e):(i=a(l),c.forEach(e=>i=i>$(l,e)&&-1<$(l,e)?$(l,e):i),t[0]=i,e+=l.slice(0,i));l=l.slice(t[0])}return u(u(e,"","#"),"","<br>")};
