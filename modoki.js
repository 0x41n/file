const de=e=>{let l=0,r,i,t;for(e=e.slice(1),i=(r=[...new Set(e.split(""))].sort()).length+1,t=parseInt(i/2),r.splice(t,0,"");l<i;l++)e=e.replaceAll(r[(l+t+1)%i],r[(l+t)%i]);return e},modoki=l=>{l=(l="ã€“"==l[0]?de(l):l).replace(/\n/g,"")+"";let e="",r,i,t,s=[0,""],$=(e,l,r=0)=>e.indexOf(l,r),o=(e,l)=>e.startsWith(l),a=e=>e.length,f=(e,l)=>""==l?b(e):`<${l}>${b(e)}</${l}>`,n=(e,l,r)=>[p(e,l)[0],f(p(e,l)[1],r),p[1]],p=(e,l,r=l)=>{var i=$(e,l)+a(l),t=$(e,r,i+1);return[t+a(r),e.slice(i,t)]},c=["1. ","- ","|","++","> ","$$","#"],h=(l,r,i=[])=>{let t="",s,c;for(let e=0;e<a(l);e++)s=$(l[e]," ")+1,c=o(l[e],"^")?` rowspan="${s}"`:o(l[e],">")?` colspan="${s}"`:"",l[e]=c?l[e].slice(s):l[e],t+=`<${r+c} style="text-align:${void 0===i[e]||2!=a(i[e].split(":"))?"center":o(i[e],":")?"left":"right"}">${l[e]}</${r}>`;return f(t,"tr")},u=(e,l,r)=>e.replaceAll(l,r),d=e=>0<$(e,"</")?d(u(e.slice(0,$(e,"</")).split("").reverse().join(""),">","</")):e,b=l=>{let e="",r=[],i,t,s,c=["*","`","~~","__","{","["];for(;0<a(l);)o(l,"*")?(r="*"==l[1]?n(l,"**","b"):n(l,"*","em"),e+=r[1]):o(l,"`")?(r=n(l,"`","code"),e+=r[1]):o(l,"~~")?(r="~"==l[2]?n(l,"~~~","pre"):n(l,"~~","strike"),e+=r[1]):o(l,"__")?(r=n(l,"__","u"),e+=r[1]):o(l,"{")?(r=p(l,"{","}"),s=r[1].split("|"),r[2]=s[1],e+=f(s[0]+f(s[1],"rt"),"ruby")):o(l,"[")?"["==l[1]?(r=p(l,"[[","]]"),e+=`<iframe src="${r[1]}"></iframe>`):(i=p(l,"[","]"),l=l.slice(i[0]),r=p(l,"(",")"),s=0<$(r[1],'"')?'"title="'+p(r[1],'"')[1]:"",r[1]=u(r[1],"#",""),s&&(r[1]=r[1].slice(0,$(r[1],'"'))),e+=`<a href="${r[1]+s+(o(r[1],"")?"":'"target="_blank"rel="noopener noreferrer')}">${b(i[1])}</a>`):(t=a(l),c.forEach(e=>t=t>$(l,e)&&-1<$(l,e)?$(l,e):t),r[0]=t,e+=l.slice(0,t)),l=l.slice(r[0]);return e};for(l=b(l);1<a(l);){if(o(l,"#"))i=6<(i=$(l," "))?6:i,s=p(l," ",""),e+=`<h${i} id="${d(s[1])}">${s[1]}</h${i}>`;else if(o(l,"++"))s=p(l,"++",""),r=s[1].split("+"),e+=f(f(r[0],"summary")+r[1],"details");else if(o(l,"- - -"))s[0]=5,e+="<hr>";else if(o(l,"- ")||o(l,"1. ")){for(t=o(l,"- ")?["- ","ul"]:["1. ","ol"],e+=`<${t[1]}>`;o(l,t[0]);)i=p(l," ",""),e+=f(i[1],"li"),l=l.slice(i[0]);e+=`</${t[1]}>`,s[0]=0}else if(o(l,"|")){for(i=p(l,"|","|"),e+="<table>"+h(i[1].split("|"),"th"),l=l.slice(i[0]-1),r=p(l,"|","|"),l=l.slice(r[0]-1);o(l,"|");)i=p(l,"|","|"),e+=h(i[1].split("|"),"td",r[1].split("|")),l=l.slice(i[0]-1);e+="</table>",s[0]=1}else if(o(l,"> ")){for(t="",l=l.slice(1);o(l,"> ");)i=$(l,"")+1,t+=l.slice(2,i),l=l.slice(i);e+=f(t,"blockquote"),s[0]=0}else o(l,"$$")?(s=p(l,"$$"),i=s[1].split("$"),e=f(i[0],"h2")+i[1]+""+e):(i=a(l),c.forEach(e=>i=i>$(l,e)&&-1<$(l,e)?$(l,e):i),s[0]=i,e+=l.slice(0,i));l=l.slice(s[0])}return u(u(e,"","#"),"","<br>")};
