const de=e=>{let l=0,r,t,i;for(e=e.slice(1),t=(r=[...new Set(e.split(""))].sort()).length+1,i=parseInt(t/2),r.splice(i,0,"");l<t;l++)e=e.replaceAll(r[(l+i+1)%t],r[(l+i)%t]);return e},modoki=l=>{l=(l="â€‹"==l[0]?de(l):l).replace(/\n/g,"")+"";let e="",r,t,i,s=[0,""],o=(e,l,r=0)=>e.indexOf(l,r),a=(e,l)=>e.startsWith(l),f=e=>e.length,n=(e,l)=>""==l?u(e):`<${l}>${u(e)}</${l}>`,p=(e,l,r)=>[h(e,l)[0],n(h(e,l)[1],r),h[1]],h=(e,l,r=l)=>{var t=o(e,l)+f(l),i=o(e,r,t+1);return[i+f(r),e.slice(t,i)]},u=(l,e)=>{let r="",t=[0,0],i=["*","`","~~","__","{","["],s,$,c;for(;0<f(l);)a(l,"*")?(t="*"==l[1]?p(l,"**","b"):p(l,"*","em"),r+=t[1]):a(l,"`")?(t=p(l,"`","code"),r+=t[1]):a(l,"~~")?(t="~"==l[2]?p(l,"~~~","pre"):p(l,"~~","strike"),r+=t[1]):a(l,"__")?(t=p(l,"__","u"),r+=t[1]):a(l,"{")?(t=h(l,"{","}"),c=t[1].split("|"),t[2]=c[1],r+=n(c[0]+n(c[1],"rt"),"ruby")):a(l,"[")?"["==l[1]?(t=h(l,"[[","]]"),r+=`<iframe src="${t[1]}"></iframe>`):($=h(l,"[","]"),l=l.slice($[0]),t=h(l,"(",")"),s=0<(c=o(t[1],'"'))?h(t[1],'"')[1]:"",t[2]=$[1],r+=`<a href="${t[1]}"title="${s}"${a(t[1],"#")?"":'target="_blank"rel="noopener noreferrer"'}>${u($[1])}</a>`):($=f(l),i.forEach(e=>$=$>o(l,e)&&-1<o(l,e)?o(l,e):$),r+=l.slice(0,$),t[0]=$),l=l.slice(t[0]);return e?t[2]:r},$=(l,r,t=[])=>{let i="",s,$;for(let e=0;e<f(l);e++)s=o(l[e]," ")+1,$=a(l[e],"^")?` rowspan="${s}"`:a(l[e],">")?` colspan="${s}"`:"",l[e]=1<f($)?l[e].slice(s):l[e],i+=`<${r+$} style="text-align:${void 0===t[e]||2!=f(t[e].split(":"))?"center":a(t[e],":")?"left":"right"}">${u(l[e])}</${r}>`;return n(i,"tr")},c=["1. ","- ","|","++","> ","$$","#"];for(;1<f(l);){if(a(l,"#"))t=6<(t=o(l," "))?6:t,s=h(l," ",""),e+=`<h${t} id="${u(s[1],1)}">${u(s[1])}</h${t}>`;else if(a(l,"++"))s=h(l,"++",""),r=s[1].split("+"),e+=n(n(r[0],"summary")+r[1],"details");else if(a(l,"- - -"))s[0]=5,e+="<hr>";else if(a(l,"- ")||a(l,"1. ")){for(i=a(l,"- ")?["- ","ul"]:["1. ","ol"],e+=`<${i[1]}>`;a(l,i[0]);)t=h(l," ",""),e+=n(t[1],"li"),l=l.slice(t[0]);e+=`</${i[1]}>`,s[0]=0}else if(a(l,"|")){for(t=h(l,"|","|"),e+="<table>"+$(t[1].split("|"),"th"),l=l.slice(t[0]-1),r=h(l,"|","|"),l=l.slice(r[0]-1);a(l,"|");)t=h(l,"|","|"),e+=$(t[1].split("|"),"td",r[1].split("|")),l=l.slice(t[0]-1);e+="</table>",s[0]=1}else if(a(l,"> ")){for(i="";a(l,"> ");)t=o(l,""),i+=l.slice(2,t),l=l.slice(t);e+=n(i,"blockquote"),s[0]=0}else a(l,"$$")?(s=h(l,"$$"),t=s[1].split("$"),e=n(t[0],"h2")+t[1]+""+e):(t=f(l),c.forEach(e=>t=t>o(l,e)&&-1<o(l,e)?o(l,e):t),s[0]=t,e+=u(l.slice(0,t)));l=l.slice(s[0])}return e.replace(//g,"<br>")};
