const modoki=l=>{l+="\n";let e="",c,n,f,i=[0,[]],o=(e,l,i=0)=>e.indexOf(l,i),$=(e,l)=>e.startsWith(l),a=(e,l)=>""==l?p(e):`<${l}>${p(e)}</${l}>`,g=(e,l,i="")=>{var s=l.length,l=o(e,l,s+1);return[l+s,a(e.slice(s,l),i)]},p=i=>{let e="",s=[0,0],r=["*","`","~~","__","{","[","#"],l;for(;0<i.length;){if($(i,"#"))l=o(i," "),s[0]=o(i,"\n")+1,l=6<l?6:l,n=i.slice(l+1,s[0]-1),e+=`<h${l} id="${n}">${n}</h${l}>`;else if($(i,"*"))s="*"==i[1]?g(i,"**","b"):g(i,"*","em"),e+=s[1];else if($(i,"`"))s=g(i,"`","code"),e+=s[1];else if($(i,"~~"))s="~"==i[2]?g(i,"~~~","pre"):g(i,"~~","strike"),e+=s[1];else if($(i,"__"))s=g(i,"__","u"),e+=s[1];else if($(i,"{"))s[0]=o(i,"}")+1,f=i.slice(1,s[0]-1).split("|"),e+=a(f[0]+a(f[1],"rt"),"ruby");else if($(i,"["))"["==i[1]?(s[0]=o(i,"]]")+2,e+=`<iframe src="${i.slice(2,s[0]-2)}"></iframe>`):(l=o(i,"]"),t=i.slice(1,l),c=i.slice(o(i,"(")+1,o(i,")"),l+1),h="",1<(f=o(c,'"')+1)&&(h=c.slice(f,o(c,'"',f)),c=c.slice(0,o(c," "))),e+=`<a href="${c}"title="${h}"${$(c,"#")?"":'target="_blank"rel="noopener noreferrer"'}>${p(t)}</a>`,s[0]=o(i,")")+1);else{let l=i.length;r.forEach(e=>l=l>o(i,e)&&-1<o(i,e)?o(i,e):l),e+=i.slice(0,l),s[0]=l}i=i.slice(s[0])}return e},s=(l,i,s=[])=>{let t="";for(let e=1;e<l.length-1;e++)t+=`<${i} style="text-align:${void 0===s[e]||2<s[e].split(":").length?"center":$(s[e],":")?"left":"right"}">${p(l[e])}</${i}>`;return a(t,"tr")},r=["1. ","- ","| ","++","> "];for(;0<l.length;){if($(l,"++"))i[0]=o(l,"\n")+1,c=l.slice(2,i[0]-1).split("|"),e+=a(a(c[0],"summary")+c[1],"details");else if($(l,"- - -"))i[0]=5,e+="<hr>";else if($(l,"- ")||$(l,"1. ")){for(f=$(l,"- ")?["- ","ul"]:["1. ","ol"],e+=`<${f[1]}>`;$(l,f[0]);)e+=a(l.slice(o(l," ")+1,o(l,"\n")),"li"),l=l.slice(o(l,"\n")+1);e+=`</${f[1]}>`,i[0]=0}else if($(l,"| ")){for(n=o(l,"\n"),f=l.slice(0,n).split("|"),e+="<table>"+s(f,"th"),l=l.slice(n+1),n=o(l,"\n"),c=l.slice(0,n).split("|"),l=l.slice(n+1);$(l,"|");)n=o(l,"\n"),f=l.slice(0,n).split("|"),e+=s(f,"td",c),l=l.slice(n+1);e+="</table>",i[0]=0}else if($(l,"> ")){for(f="";$(l,"> ");)n=o(l,"\n")+1,f+=l.slice(2,n),l=l.slice(n);e+=a(f,"blockquote"),i[0]=0}else n=l.length,r.forEach(e=>n=n>o(l,e)&&-1<o(l,e)?o(l,e):n),i[0]=n,e+=p(l.slice(0,n));l=l.slice(i[0])}return e.replace(/\n/g,"<br>")};
