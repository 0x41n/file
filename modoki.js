const modoki=l=>{l+="\n";let e="",i,s,t,r=[0,[]],f=(e,l,i=0)=>e.indexOf(l,i),o=(e,l)=>e.startsWith(l),a=(e,l)=>`<${l}>${c(e)}</${l}>`,h=(e,l,i="")=>{var s=l.length,l=f(e,l,s+1);return[l+s,a(e.slice(s,l),i)]},c=r=>{let c="",n=[0,0],e=["*","`","~~","__","[","#"],l;for(;0<r.length;){if(o(r,"#"))l=f(r," "),s=f(r,"\n"),l=6<l?6:l,c+=a(r.slice(l+1,s),"h"+l),n[0]=s+1;else if(o(r,"*"))n="*"==r[1]?h(r,"**","b"):h(r,"*","em"),c+=n[1];else if(o(r,"`"))n=h(r,"`","code"),c+=n[1];else if(o(r,"~~"))n="~"==r[2]?h(r,"~~~","pre"):h(r,"~~","strike"),c+=n[1];else if(o(r,"__"))n=h(r,"__","u"),c+=n[1];else if(o(r,"["))if("["==r[1])n[0]=f(r,"]]")+2,c+=`<iframe src="${r.slice(2,n[0]-2)}"></iframe>`;else{let e=f(r,"]"),l=r.slice(1,e),i=r.slice(f(r,"(")+1,f(r,")"),e+1),s="",t=f(i,'"')+1;1<t&&(s=i.slice(t,f(i,'"',t)),i=i.slice(0,f(i," "))),c+=`<a href="${i}"title="${s}"target="_blank"rel="noopener noreferrer">${l}</a>`,n[0]=f(r,")")+1}else{let l=r.length;e.forEach(e=>l=l>f(r,e)&&-1<f(r,e)?f(r,e):l),c+=r.slice(0,l),n[0]=l}r=r.slice(n[0])}return c},n=(l,i,s=[])=>{let t="";for(let e=1;e<l.length-1;e++)t+=`<${i} style="text-align:${void 0===s[e]||2<s[e].split(":").length?"center":o(s[e],":")?"left":"right"}">${c(l[e])}</${i}>`;return a(t,"tr")},$=["1. ","- ","|","++","> "];for(;0<l.length;){if(o(l,"++"))r[0]=f(l,"\n")+1,i=l.slice(2,r[0]-1).split("|"),e+=a(a(i[0],"summary")+i[1],"details");else if(o(l,"- - -"))r[0]=5,e+="<hr>";else if(o(l,"- ")||o(l,"1. ")){for(t=o(l,"- ")?["- ","ul"]:["1. ","ol"],e+=`<${t[1]}>`;o(l,t[0]);)e+=a(l.slice(f(l," ")+1,f(l,"\n")),"li"),l=l.slice(f(l,"\n")+1);e+=`</${t[1]}>`,r[0]=0}else if(o(l,"|")){for(s=f(l,"\n"),t=l.slice(0,s).split("|"),e+="<table>"+n(t,"th"),l=l.slice(s+1),s=f(l,"\n"),i=l.slice(0,s).split("|"),l=l.slice(s+1);o(l,"|");)s=f(l,"\n"),t=l.slice(0,s).split("|"),e+=n(t,"td",i),l=l.slice(s+1);e+="</table>",r[0]=0}else if(o(l,"> ")){for(t="";o(l,"> ");)s=f(l,"\n")+1,t+=l.slice(2,s),l=l.slice(s);e+=a(t,"blockquote"),r[0]=0}else s=l.length,$.forEach(e=>s=s>f(l,e)&&-1<f(l,e)?f(l,e):s),r[0]=s,e+=c(l.slice(0,s));l=l.slice(r[0])}return e.replace(/\n/g,"<br>")};
